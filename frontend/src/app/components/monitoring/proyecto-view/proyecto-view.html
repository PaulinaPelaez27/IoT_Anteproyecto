<div class="h-full flex flex-col">
  @if (project(); as proj) {
    <!-- Breadcrumb -->
    <div class="px-8 py-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
      <div class="text-sm text-gray-500 dark:text-gray-400 mb-2 flex items-center">
        <span>Projects</span>
        <span class="mx-2">&gt;</span>
        <span class="text-gray-900 dark:text-gray-100 font-medium">{{ proj.nombre }}</span>
      </div>
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-2">
          <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100">{{ proj.nombre }}</h1>
          <ui-button
            variant="ghost"
            [iconOnly]="true"
            ariaLabel="Cambiar datos del proyecto"
            tooltip="Cambiar datos del proyecto"
            size="medium"
            (click)="openEditProject()"
          >
            <lucide-angular [img]="pencilIcon"></lucide-angular>
          </ui-button>
          <ui-button
            variant="ghost"
            [iconOnly]="true"
            ariaLabel="Eliminar proyecto"
            tooltip="Eliminar proyecto"
            size="medium"
          >
            <lucide-angular [img]="trashIcon"></lucide-angular>
          </ui-button>
        </div>
        <ui-button type="button" variant="primary" size="medium" aria-label="Agregar un nodo al proyecto seleccionado" tooltip="Agregar un nodo al proyecto seleccionado">
          + Agregar Nodo
        </ui-button>
      </div>
      <p class="text-gray-600 dark:text-gray-300 mt-1">{{ proj.descripcion }}</p>
    </div>

    <!-- Node Tabs (Folder Style) -->
    <div class="px-8 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
      <div class="flex space-x-2 -mb-px">
        @for (node of nodes(); track node.id) {
          <button
            (click)="selectNode(node.id)"
            [class.bg-white]="selectedNode()?.id === node.id"
            [class.dark:bg-gray-800]="selectedNode()?.id === node.id"
            [class.border-b-0]="selectedNode()?.id === node.id"
            [class.bg-gray-100]="selectedNode()?.id !== node.id"
            [class.dark:bg-gray-950]="selectedNode()?.id !== node.id"
            class="px-4 py-3 rounded-t-lg border border-gray-200 dark:border-gray-700 flex items-center space-x-2 hover:bg-white dark:hover:bg-gray-800 transition-colors">
            <span [class]="getStatusColor(node.estado) + ' w-2 h-2 rounded-full'"></span>
            <span class="font-medium text-gray-900 dark:text-gray-100">{{ node.nombre }}</span>
          </button>
        }
      </div>
    </div>

    <!-- Node Dashboard -->
    @if (selectedNode(); as node) {
      <div class="flex-1 overflow-y-auto p-8">
        <!-- Node Header -->
        <div class="mb-6">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-2 gap-4">
            <!-- Title & Description -->
            <div>
              <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100">{{ node.nombre }}</h2>
              <p class="text-gray-600 dark:text-gray-300">{{ node.descripcion }}</p>
            </div>
            <!-- Status, Battery, Sensors, Add Sensor Button -->
            <div class="flex flex-col items-start space-y-2 md:items-end md:space-y-0 md:flex-row md:space-x-4">
              <div class="flex items-center space-x-4">
              <span [class]="'px-3 py-1 rounded-full text-sm font-medium ' + (node.estado ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200')">
                {{ node.estado ? 'Activo' : 'Inactivo' }}
              </span>
              <div class="flex items-center space-x-2 text-gray-600 dark:text-gray-300">
                <lucide-angular [img]="batteryIcon" class="w-5 h-5"></lucide-angular>
                <span class="text-sm font-medium">{{ node.bateria }}%</span>
              </div>
              <div class="text-sm text-gray-500 dark:text-gray-400">
                {{ sensors().length }} sensores
              </div>
              </div>
              <ui-button type="button" variant="primary" size="small" class="mt-2 md:mt-0">
              + Agregar Sensor
              </ui-button>
            </div>
          </div>
        </div>

        <!-- Sensors Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          @for (sensor of sensors(); track sensor.id) {
            <div [class]="'border-l-4 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow cursor-pointer bg-white dark:bg-gray-800 ' + getSensorStatusColor(sensor.status)" (click)="openSensorView(sensor.id)">
              <div class="flex items-start justify-between mb-4">
                <div>
                  <h4 class="font-semibold text-gray-900 dark:text-gray-100">{{ sensor.name }}</h4>
                  <p class="text-sm text-gray-600 dark:text-gray-400">{{ sensor.type }}</p>
                </div>
                <span [class]="'w-3 h-3 rounded-full ' + getStatusColor(sensor.status)"></span>
              </div>
              
              <div class="flex flex-wrap gap-2">
                @for (rt of sensor.readingTypes; track rt.id) {
                  <span class="px-2 py-1 bg-white dark:bg-gray-700 rounded text-xs font-medium text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-gray-600">
                    {{ rt.name }}
                  </span>
                }
              </div>
            </div>
          }
        </div>
      </div>
    }
  } @else {
    <div class="flex items-center justify-center h-full">
      <div class="text-center text-gray-500 dark:text-gray-400">
        <p class="text-lg">Project not found</p>
      </div>
    </div>
  }

  <!-- Sensor Details View Slide-in Panel -->
  <app-sensor-details-view></app-sensor-details-view>
</div>
